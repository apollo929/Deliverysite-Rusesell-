(self.webpackChunkdfobobcat=self.webpackChunkdfobobcat||[]).push([[8925],{8925:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SingleJobPageModule:()=>v});var n=i(2057),o=i(3738),s=i(3498),r=i(3707),c=i(8535),d=i(793),l=i(4705),a=i(6738),u=i(9765),p=i(8229),m=i(4694),h=i(8002);function f(e,t){1&e&&(d.TgZ(0,"h1"),d._uU(1,"Submit request"),d.qZA())}function g(e,t){1&e&&(d.TgZ(0,"h1"),d._uU(1,"Edit request"),d.qZA())}const b=function(){return{}};function q(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"bc-select",15),d.NdJ("selected",function(t){return d.CHM(e),d.oxw().equpmentSelected(t)}),d.qZA()}if(2&e){const e=t.ngIf,i=d.oxw();d.Q6J("control",i.selectedEquipmentInput)("multiple",!0)("inputBackground","#fff")("options",e||d.DdM(5,b))("triggerCD",i.triggerCDChildren)}}function C(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"bc-datepicker",16),d.NdJ("selected",function(t){return d.CHM(e),d.oxw().dateSelected(t)}),d.qZA()}if(2&e){const e=t.ngIf,i=d.oxw();d.Q6J("min",e)("control",i.datetime)}}let x=(()=>{class e{constructor(e,t,i,n,s,r,c,l,a){this.fb=e,this.route=t,this.cdRef=i,this.createJobGQL=n,this.updateJobGQL=s,this.jobGQL=r,this.settingsGQL=c,this.equipmentGQL=l,this.router=a,this.perfectScrollbarConfig={},this.equipment$=new u.xQ,this.minDate$=new p.t(1),this.selectedDate="",this.selectedEquipment=[],this.selectedCoordinates={lat:void 0,lng:void 0},this.job$=new u.xQ,this.uploadedPO$=new u.xQ,this.triggerCDChildren=new d.vpe,this.form=e.group({datetime:["",[o.kI.required]],selectedEquipmentInput:["",[o.kI.required]],address:["",[o.kI.required]],notes:["",[o.kI.required]],priority:[""]})}ionViewWillEnter(){this.route.params.subscribe(e=>{e.id&&(this.jobId=+e.id),this.jobId&&this.getJob(),this.settingsGQL.fetch().subscribe(e=>{this.minDate$.next(a(e.data.settings.minJobRequestDate))}),this.equipmentGQL.fetch().subscribe(e=>{const t=e.data.equipment.reduce((e,t)=>(e[t.id]=t.name,e),{});this.equipment$.next(t)})})}get datetime(){return this.form.get("datetime")}get selectedEquipmentInput(){return this.form.get("selectedEquipmentInput")}get address(){return this.form.get("address")}getEquipment(){return this.job$.pipe((0,h.U)(e=>e.equipment?e.equipment.map(e=>e.name).join(", "):""))}dateSelected(e=""){this.selectedDate=e}equpmentSelected(e){this.selectedEquipment=e}addressSelected(e){this.selectedCoordinates=e}getJob(){this.jobGQL.fetch({id:this.jobId}).subscribe(e=>{const t=e.data.job;this.job$.next(t),this.uploadedPO$.next(t.poFile?t.poFile:""),this.equpmentSelected(Array.isArray(t.equipment)?t.equipment.filter(e=>!!e.id).map(e=>e.id):[]),this.dateSelected(t.requestDate),this.addressSelected({lat:t.lat,lng:t.lng}),this.form.setValue({address:t.address,datetime:a(t.requestDate).utc().format("MMM D, dddd"),selectedEquipmentInput:t.equipment&&Array.isArray(t.equipment)?t.equipment.map(e=>e.name).join(", "):""})})}resetForm(){this.form.reset(),Object.keys(this.form.controls).forEach(e=>this.form.controls[e].reset()),this.selectedCoordinates={lat:void 0,lng:void 0},this.selectedEquipment=[],this.selectedDate="",this.addressComponent.cdRef.markForCheck();for(const e of this.selectComponent.optionsControls)e[2].setValue(!1);this.triggerCDChildren.next()}submit(){if(this.form.invalid){for(const e of Object.keys(this.form.controls))this.form.controls[e].markAsDirty();return void this.addressComponent.cdRef.markForCheck()}const e={address:this.form.controls.address.value,equipment:this.selectedEquipment,lng:this.selectedCoordinates.lng,lat:this.selectedCoordinates.lat,requestDate:this.selectedDate,notes:this.form.controls.notes.value,priority:""};this.uploadedPo&&(e.poFile=this.uploadedPo),this.jobId?this.updateJobGQL.mutate({input:Object.assign(Object.assign({},e),{id:this.jobId})},{context:{useMultipart:!0}}).subscribe(()=>{this.router.navigate(["/builder","jobs"])}):this.createJobGQL.mutate({input:e},{context:{useMultipart:!0}}).subscribe(()=>{this.router.navigate(["/builder","jobs"])})}poUpload(e){this.uploadedPo=e}ionViewWillLeave(){this.resetForm()}}return e.\u0275fac=function(t){return new(t||e)(d.Y36(o.qu),d.Y36(c.gz),d.Y36(d.sBO),d.Y36(l.Kg),d.Y36(l.hh),d.Y36(l.Gp),d.Y36(l.QO),d.Y36(l.L_),d.Y36(c.F0))},e.\u0275cmp=d.Xpm({type:e,selectors:[["bc-single-job"]],viewQuery:function(e,t){if(1&e&&(d.Gf(m.QQ,5),d.Gf(m.Hr,5)),2&e){let e;d.iGM(e=d.CRH())&&(t.addressComponent=e.first),d.iGM(e=d.CRH())&&(t.selectComponent=e.first)}},decls:22,vars:17,consts:[[3,"scrollY"],[2,"max-height","880px",3,"config"],[1,"page-wrapper"],[4,"ngIf"],[3,"formGroup","submit"],["ngDefaultControl","",3,"formControl","selected"],["style","z-index: 15;","placeholder","Select equipment","theme","dark","label","Type of building equipment",3,"control","multiple","inputBackground","options","triggerCD","selected",4,"ngIf"],["style","z-index: 10;","placeholder","Select a date",3,"min","control","selected",4,"ngIf"],[1,"attach-po-input"],[3,"fileName","upload"],[1,"notes",2,"z-index","1"],["placeholder","Write a note","theme","dark","label","Notes",3,"control"],[2,"flex","1 0 auto"],["type","submit","expand","block","size","large","shape","round"],["slot","start","src","/assets/icon/truck.svg"],["placeholder","Select equipment","theme","dark","label","Type of building equipment",2,"z-index","15",3,"control","multiple","inputBackground","options","triggerCD","selected"],["placeholder","Select a date",2,"z-index","10",3,"min","control","selected"]],template:function(e,t){if(1&e&&(d._UZ(0,"bc-header"),d.TgZ(1,"ion-content",0),d.TgZ(2,"perfect-scrollbar",1),d.TgZ(3,"div",2),d.YNc(4,f,2,0,"h1",3),d.YNc(5,g,2,0,"h1",3),d.TgZ(6,"form",4),d.NdJ("submit",function(){return t.submit()}),d.TgZ(7,"bc-address-input",5),d.NdJ("selected",function(e){return t.addressSelected(e)}),d.qZA(),d.YNc(8,q,1,6,"bc-select",6),d.ALo(9,"async"),d.YNc(10,C,1,2,"bc-datepicker",7),d.ALo(11,"async"),d.TgZ(12,"div",8),d.TgZ(13,"bc-file-upload",9),d.NdJ("upload",function(e){return t.poUpload(e)}),d.ALo(14,"async"),d.qZA(),d.qZA(),d.TgZ(15,"div",10),d._UZ(16,"bc-input",11),d.qZA(),d._UZ(17,"div",12),d.TgZ(18,"ion-button",13),d._UZ(19,"ion-icon",14),d.TgZ(20,"span"),d._uU(21),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&e){let e;d.xp6(1),d.Q6J("scrollY",!1),d.xp6(1),d.Q6J("config",t.perfectScrollbarConfig),d.xp6(2),d.Q6J("ngIf",!t.jobId),d.xp6(1),d.Q6J("ngIf",t.jobId),d.xp6(1),d.Q6J("formGroup",t.form),d.xp6(1),d.Q6J("formControl",t.address),d.xp6(1),d.Q6J("ngIf",d.lcZ(9,11,t.equipment$)),d.xp6(2),d.Q6J("ngIf",d.lcZ(11,13,t.minDate$)),d.xp6(3),d.Q6J("fileName",null!==(e=d.lcZ(14,15,t.uploadedPO$))&&void 0!==e?e:""),d.xp6(3),d.Q6J("control",t.form.controls.notes),d.xp6(5),d.Oqu(t.jobId?"edit":"submit")}},directives:[m.Gt,s.W2,r.Vv,n.O5,o._Y,o.JL,o.sg,m.QQ,o.Fj,o.JJ,o.oH,m.Yr,m.am,s.YG,s.gu,m.Hr,m.QB],pipes:[n.Ov],styles:["bc-address-input[_ngcontent-%COMP%], bc-input[_ngcontent-%COMP%], bc-select[_ngcontent-%COMP%]{margin-bottom:36px;display:block}bc-file-upload[_ngcontent-%COMP%]{display:block;margin-top:24px}form[_ngcontent-%COMP%]{display:flex;flex-flow:column}.page-wrapper[_ngcontent-%COMP%], form[_ngcontent-%COMP%]{height:100%}ion-item[_ngcontent-%COMP%]{--inner-padding-end:40px}.notes[_ngcontent-%COMP%]{margin-top:34px}"],changeDetection:0}),e})();const Z=[{path:"",component:x},{path:":id",component:x}];let Q=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.oAB({type:e}),e.\u0275inj=d.cJS({imports:[[c.Bz.forChild(Z)],c.Bz]}),e})();var J=i(5967);const k={suppressScrollX:!0};let v=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.oAB({type:e}),e.\u0275inj=d.cJS({providers:[{provide:r.op,useValue:k}],imports:[[n.ez,o.u5,o.UX,s.Pc,Q,J.C,r.Xd]]}),e})()}}]);