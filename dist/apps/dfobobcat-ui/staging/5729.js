(self.webpackChunkdfobobcat=self.webpackChunkdfobobcat||[]).push([[5729],{5729:(t,e,o)=>{"use strict";o.r(e),o.d(e,{ClockInPageModule:()=>k});var i=o(2057),n=o(3738),s=o(3498),r=o(8535),a=o(793),c=o(4705),d=o(4402),l=o(5917),g=o(4612),p=o(7422),u=o(1108),h=o(4694);const b=["imageList"],f=function(){return["/staff","jobs"]},m=[{path:"",component:(()=>{class t{constructor(t,e,o,i,s,r,a,c,d,l,g){this.renderer=t,this.addClockInGQL=e,this.state=o,this.alertController=i,this.router=s,this.route=r,this.loadingService=a,this.configService=c,this.geolocation=d,this.alertService=l,this.hasClockedIntoJobIdGQL=g,this.fileControl=new n.NI,this.noteControl=new n.NI(""),this.images=[],this.error=!1,this.errorMessage="Allowed file formats: *.pdf"}ngOnInit(){this.route.params.subscribe(t=>{this.jobId=+t.id})}onUpload(t){const e=t=>new Promise((e,o)=>{if(!["image/jpeg","image/png"].includes(t.type))return void o();this.images.push(t);const i=new FileReader;i.onload=t=>{const o=this.renderer.createElement("img");o.src=t.target.result,this.imageList.nativeElement.appendChild(o),e()},i.readAsDataURL(t)});if(t.target.files.length>0){const o=[];for(const i of t.target.files)o.push(e(i));this.loadingService.show().pipe((0,g.b)(()=>(0,d.D)(Promise.all(o))),(0,g.b)(()=>(0,d.D)(this.loadingService.dismiss()))).subscribe()}}validateImages(){0===this.images.length?alert("Adding photos is now required for clocking!"):this.submit()}submit(){let t;t=this.configService.get("production")?(0,d.D)(this.geolocation.getCurrentPosition()):(0,l.of)({coords:{latitude:123,longitude:123}});const e={};t.pipe((0,g.b)(t=>{var o,i;const n=null===(o=null==t?void 0:t.coords)||void 0===o?void 0:o.latitude,s=null===(i=null==t?void 0:t.coords)||void 0===i?void 0:i.longitude;return e.lat=n,e.lng=s,n&&s?this.hasClockedIntoJobIdGQL.fetch({id:this.jobId}):this.alertService.show({message:"Could not get your location. Clock In failed.",type:"error"})}),(0,g.b)(t=>t&&"hasClockedIntoJob"in t.data.me&&t.data.me.hasClockedIntoJob?(this.router.navigate(["/staff","clock-off",this.jobId]),(0,l.of)(void 0)):this.addClockInGQL.mutate({input:{jobId:this.jobId,lat:e.lat,lng:e.lng,files:this.images}},{context:{useMultipart:!0}}))).subscribe(t=>{this.alertService.show({message:"Clock in success!"}).subscribe(),this.router.navigate(["/staff","jobs"])})}}return t.\u0275fac=function(e){return new(e||t)(a.Y36(a.Qsj),a.Y36(c.Ll),a.Y36(p.b2),a.Y36(s.Br),a.Y36(r.F0),a.Y36(r.gz),a.Y36(p.bz),a.Y36(p.E4),a.Y36(u.b),a.Y36(p.c9),a.Y36(c.VY))},t.\u0275cmp=a.Xpm({type:t,selectors:[["bc-clock-in"]],viewQuery:function(t,e){if(1&t&&a.Gf(b,5,a.SBq),2&t){let t;a.iGM(t=a.CRH())&&(e.imageList=t.first)}},decls:24,vars:4,consts:[[3,"scrollY"],[1,"page-wrapper"],[1,"note"],[1,"images-wrap"],["imageList",""],[1,"add-photo",3,"click"],["src","/assets/icon/add.svg",1,"add-photo-icon"],["multiple","true","accept","image/jpeg,image/png","type","file",3,"change"],["fileInput",""],["type","button","shape","round",1,"back-btn",3,"routerLink"],["slot","start","src","/assets/icon/back-sm.svg"],[2,"flex","1 0 auto"],["type","button","expand","block","size","large","shape","round",3,"disabled","click"],["slot","start","src","/assets/icon/submit.svg"]],template:function(t,e){if(1&t){const t=a.EpF();a._UZ(0,"bc-header"),a.TgZ(1,"ion-content",0),a.TgZ(2,"div",1),a.TgZ(3,"h1"),a._uU(4,"Clock In"),a.qZA(),a.TgZ(5,"div",2),a._uU(6,"NOTE: images are required."),a.qZA(),a.TgZ(7,"div",3,4),a.TgZ(9,"div",5),a.NdJ("click",function(){return a.CHM(t),a.MAs(14).click()}),a._UZ(10,"ion-icon",6),a.TgZ(11,"span"),a._uU(12,"Add photo"),a.qZA(),a.TgZ(13,"input",7,8),a.NdJ("change",function(t){return e.onUpload(t)}),a.qZA(),a.qZA(),a.qZA(),a.TgZ(15,"ion-button",9),a._UZ(16,"ion-icon",10),a.TgZ(17,"span"),a._uU(18,"back to jobs"),a.qZA(),a.qZA(),a._UZ(19,"div",11),a.TgZ(20,"ion-button",12),a.NdJ("click",function(){return e.submit()}),a._UZ(21,"ion-icon",13),a.TgZ(22,"span"),a._uU(23,"submit"),a.qZA(),a.qZA(),a.qZA(),a.qZA()}2&t&&(a.xp6(1),a.Q6J("scrollY",!0),a.xp6(14),a.Q6J("routerLink",a.DdM(3,f)),a.xp6(5),a.Q6J("disabled",0===e.images.length))},directives:[h.Gt,s.W2,s.gu,s.YG,s.YI,r.rH],styles:[".images-wrap[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr;grid-gap:10px;margin-bottom:35px}.images-wrap[_ngcontent-%COMP%]   .add-photo[_ngcontent-%COMP%]{border:1px dashed #004853;border-radius:8px;display:flex;flex-flow:column nowrap;align-items:center;justify-content:center;height:98px;width:98px}.images-wrap[_ngcontent-%COMP%]   .add-photo[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{width:24px;height:24px}.images-wrap[_ngcontent-%COMP%]   .add-photo[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.images-wrap[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{object-fit:cover;object-position:center;height:98px;width:98px;border-radius:8px}ion-button.back-btn[_ngcontent-%COMP%]{margin-top:56px}[_nghost-%COMP%]   .page-wrapper[_ngcontent-%COMP%]   .add-photo[_ngcontent-%COMP%]   ion-icon.add-photo-icon[_ngcontent-%COMP%]{width:34px;height:34px}.note[_ngcontent-%COMP%]{font-size:16px;line-height:22px;margin-bottom:24px;text-align:center}"],changeDetection:0}),t})()}];let C=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=a.oAB({type:t}),t.\u0275inj=a.cJS({imports:[[r.Bz.forChild(m)],r.Bz]}),t})();var v=o(5967);let k=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=a.oAB({type:t}),t.\u0275inj=a.cJS({providers:[u.b],imports:[[i.ez,n.u5,s.Pc,C,v.C,n.UX]]}),t})()}}]);