(self.webpackChunkdfobobcat=self.webpackChunkdfobobcat||[]).push([[5025],{5025:(t,e,n)=>{"use strict";n.r(e),n.d(e,{ClockOffPageModule:()=>q});var i=n(2057),o=n(3738),s=n(3498),r=n(8535),a=n(4762),c=n(793),g=n(4705),l=n(4402),d=n(8002),p=n(4612),u=n(7422),h=n(4694);const f=["imageList"];function m(t,e){1&t&&(c.TgZ(0,"div",16),c._uU(1," NOTE: images are required. "),c.qZA())}function b(t,e){1&t&&(c.TgZ(0,"div",16),c._uU(1," Images are not required, but it will be good if you add them. "),c.qZA())}const C=function(){return["/staff","jobs"]};function Z(t,e){if(1&t){const t=c.EpF();c.TgZ(0,"ion-content",1),c.TgZ(1,"div",2),c.TgZ(2,"h1"),c._uU(3,"Clock Off"),c.qZA(),c.YNc(4,m,2,0,"div",3),c.YNc(5,b,2,0,"div",3),c.TgZ(6,"div",4,5),c.TgZ(8,"div",6),c.NdJ("click",function(){return c.CHM(t),c.MAs(13).click()}),c._UZ(9,"ion-icon",7),c.TgZ(10,"span"),c._uU(11,"Add photo"),c.qZA(),c.TgZ(12,"input",8,9),c.NdJ("change",function(e){return c.CHM(t),c.oxw().onUpload(e)}),c.qZA(),c.qZA(),c.qZA(),c._UZ(14,"bc-input",10),c.TgZ(15,"ion-button",11),c._UZ(16,"ion-icon",12),c.TgZ(17,"span"),c._uU(18,"back to jobs"),c.qZA(),c.qZA(),c._UZ(19,"div",13),c.TgZ(20,"ion-button",14),c.NdJ("click",function(){return c.CHM(t),c.oxw().submit()}),c._UZ(21,"ion-icon",15),c.TgZ(22,"span"),c._uU(23,"submit"),c.qZA(),c.qZA(),c.qZA(),c.qZA()}if(2&t){const t=e.ngIf,n=c.oxw();c.Q6J("scrollY",!0),c.xp6(4),c.Q6J("ngIf",t.imagesRequired&&0===n.images.length),c.xp6(1),c.Q6J("ngIf",!t.imagesRequired&&0===n.images.length),c.xp6(9),c.Q6J("control",n.noteControl),c.xp6(1),c.Q6J("routerLink",c.DdM(6,C)),c.xp6(5),c.Q6J("disabled",t.imagesRequired&&0===n.images.length)}}const x=function(t){return{imagesRequired:t}},w=[{path:"",component:(()=>{class t{constructor(t,e,n,i,s,r,a){this.renderer=t,this.addClockOffGql=e,this.state=n,this.alertController=i,this.router=s,this.route=r,this.loadingService=a,this.fileControl=new o.NI,this.noteControl=new o.NI(""),this.images=[],this.error=!1,this.errorMessage="Allowed file formats: *.pdf"}ngOnInit(){this.route.params.subscribe(t=>{this.jobId=+t.id}),this.imagesRequired$=this.state.select(t=>t.user).pipe((0,d.U)(t=>!("operator"!==(null==t?void 0:t.role))))}onUpload(t){const e=t=>new Promise((e,n)=>{if(!["image/jpeg","image/png"].includes(t.type))return void n();this.images.push(t);const i=new FileReader;i.onload=t=>{const n=this.renderer.createElement("img");n.src=t.target.result,this.imageList.nativeElement.appendChild(n),e()},i.readAsDataURL(t)});if(t.target.files.length>0){const n=[];for(const i of t.target.files)n.push(e(i));this.loadingService.show().pipe((0,p.b)(()=>(0,l.D)(Promise.all(n))),(0,p.b)(()=>(0,l.D)(this.loadingService.dismiss()))).subscribe()}}validateImages(){0===this.images.length?alert("Adding photos is now required for clocking!"):this.submit()}submit(){this.addClockOffGql.mutate({input:{jobId:this.jobId,notes:this.noteControl.value,files:this.images}},{context:{useMultipart:!0}}).subscribe(()=>(0,a.mG)(this,void 0,void 0,function*(){const t=yield this.alertController.create({cssClass:"bc-success-popup",header:"Success",message:"Clocked off successfully!",buttons:["Dismiss"]});yield t.present(),this.router.navigate(["/staff","jobs"])}))}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(c.Qsj),c.Y36(g.uY),c.Y36(u.b2),c.Y36(s.Br),c.Y36(r.F0),c.Y36(r.gz),c.Y36(u.bz))},t.\u0275cmp=c.Xpm({type:t,selectors:[["dfobobcat-clock-off"]],viewQuery:function(t,e){if(1&t&&c.Gf(f,5,c.SBq),2&t){let t;c.iGM(t=c.CRH())&&(e.imageList=t.first)}},decls:3,vars:5,consts:[[3,"scrollY",4,"ngIf"],[3,"scrollY"],[1,"page-wrapper"],["class","note",4,"ngIf"],[1,"images-wrap"],["imageList",""],[1,"add-photo",3,"click"],["src","/assets/icon/add.svg",1,"add-photo-icon"],["multiple","true","accept","image/jpeg,image/png","type","file",3,"change"],["fileInput",""],["placeholder","Write a note","theme","dark","label","Notes",3,"control"],["type","button","shape","round",1,"back-btn",3,"routerLink"],["slot","start","src","/assets/icon/back-sm.svg"],[2,"flex","1 0 auto"],["type","button","expand","block","size","large","shape","round",3,"disabled","click"],["slot","start","src","/assets/icon/submit.svg"],[1,"note"]],template:function(t,e){1&t&&(c._UZ(0,"bc-header"),c.YNc(1,Z,24,7,"ion-content",0),c.ALo(2,"async")),2&t&&(c.xp6(1),c.Q6J("ngIf",c.VKq(3,x,c.lcZ(2,1,e.imagesRequired$))))},directives:[h.Gt,i.O5,s.W2,s.gu,h.am,s.YG,s.YI,r.rH],pipes:[i.Ov],styles:[".images-wrap[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr;grid-gap:10px;margin-bottom:35px}.images-wrap[_ngcontent-%COMP%]   .add-photo[_ngcontent-%COMP%]{border:1px dashed #004853;border-radius:8px;display:flex;flex-flow:column nowrap;align-items:center;justify-content:center;height:98px;width:98px}.images-wrap[_ngcontent-%COMP%]   .add-photo[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{width:24px;height:24px}.images-wrap[_ngcontent-%COMP%]   .add-photo[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.images-wrap[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{object-fit:cover;object-position:center;height:98px;width:98px;border-radius:8px}ion-button.back-btn[_ngcontent-%COMP%]{margin-top:56px}[_nghost-%COMP%]   .page-wrapper[_ngcontent-%COMP%]   .add-photo[_ngcontent-%COMP%]   ion-icon.add-photo-icon[_ngcontent-%COMP%]{width:34px;height:34px}.note[_ngcontent-%COMP%]{font-size:16px;line-height:22px;margin-bottom:24px;text-align:center}"],changeDetection:0}),t})()}];let v=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.oAB({type:t}),t.\u0275inj=c.cJS({imports:[[r.Bz.forChild(w)],r.Bz]}),t})();var _=n(5967);let q=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.oAB({type:t}),t.\u0275inj=c.cJS({imports:[[i.ez,o.u5,o.UX,s.Pc,v,_.C]]}),t})()}}]);